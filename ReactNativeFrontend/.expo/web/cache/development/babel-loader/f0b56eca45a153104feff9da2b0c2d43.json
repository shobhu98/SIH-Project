{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[typeof Symbol === \"function\" ? Symbol.iterator : \"@@iterator\"] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } it = o[typeof Symbol === \"function\" ? Symbol.iterator : \"@@iterator\"](); return it.next.bind(it); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport { PermissionStatus } from \"./Permissions.types\";\n\nfunction _getUserMedia(constraints) {\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    return navigator.mediaDevices.getUserMedia(constraints);\n  }\n\n  var getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || function () {\n    var error = new Error('Permission unimplemented');\n    error.code = 0;\n    error.name = 'NotAllowedError';\n    throw error;\n  };\n\n  return new Promise(function (resolve, reject) {\n    getUserMedia.call(navigator, constraints, resolve, reject);\n  });\n}\n\nfunction askForMediaPermissionAsync(options) {\n  var message;\n  return _regeneratorRuntime.async(function askForMediaPermissionAsync$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          _context.next = 3;\n          return _regeneratorRuntime.awrap(_getUserMedia(options));\n\n        case 3:\n          return _context.abrupt(\"return\", {\n            status: PermissionStatus.GRANTED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: true\n          });\n\n        case 6:\n          _context.prev = 6;\n          _context.t0 = _context[\"catch\"](0);\n          message = _context.t0.message;\n\n          if (!(message === 'Permission dismissed')) {\n            _context.next = 13;\n            break;\n          }\n\n          return _context.abrupt(\"return\", {\n            status: PermissionStatus.UNDETERMINED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false\n          });\n\n        case 13:\n          return _context.abrupt(\"return\", {\n            status: PermissionStatus.DENIED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false\n          });\n\n        case 14:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, [[0, 6]], Promise);\n}\n\nfunction askForMicrophonePermissionAsync() {\n  return _regeneratorRuntime.async(function askForMicrophonePermissionAsync$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return _regeneratorRuntime.awrap(askForMediaPermissionAsync({\n            audio: true\n          }));\n\n        case 2:\n          return _context2.abrupt(\"return\", _context2.sent);\n\n        case 3:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction askForCameraPermissionAsync() {\n  return _regeneratorRuntime.async(function askForCameraPermissionAsync$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.next = 2;\n          return _regeneratorRuntime.awrap(askForMediaPermissionAsync({\n            video: true\n          }));\n\n        case 2:\n          return _context3.abrupt(\"return\", _context3.sent);\n\n        case 3:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction askForLocationPermissionAsync() {\n  return _regeneratorRuntime.async(function askForLocationPermissionAsync$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          return _context4.abrupt(\"return\", new Promise(function (resolve) {\n            navigator.geolocation.getCurrentPosition(function () {\n              return resolve({\n                status: PermissionStatus.GRANTED,\n                expires: 'never',\n                canAskAgain: true,\n                granted: true\n              });\n            }, function (_ref2) {\n              var code = _ref2.code;\n\n              if (code === 1) {\n                resolve({\n                  status: PermissionStatus.DENIED,\n                  expires: 'never',\n                  canAskAgain: true,\n                  granted: false\n                });\n              } else {\n                resolve({\n                  status: PermissionStatus.UNDETERMINED,\n                  expires: 'never',\n                  canAskAgain: true,\n                  granted: false\n                });\n              }\n            });\n          }));\n\n        case 1:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction getPermissionWithQueryAsync(name) {\n  var _await$navigator$perm, state;\n\n  return _regeneratorRuntime.async(function getPermissionWithQueryAsync$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          if (!(!navigator || !navigator.permissions || !navigator.permissions.query)) {\n            _context5.next = 2;\n            break;\n          }\n\n          return _context5.abrupt(\"return\", null);\n\n        case 2:\n          _context5.next = 4;\n          return _regeneratorRuntime.awrap(navigator.permissions.query({\n            name: name\n          }));\n\n        case 4:\n          _await$navigator$perm = _context5.sent;\n          state = _await$navigator$perm.state;\n\n          if (!(state === 'prompt')) {\n            _context5.next = 10;\n            break;\n          }\n\n          return _context5.abrupt(\"return\", PermissionStatus.UNDETERMINED);\n\n        case 10:\n          if (!(state === 'granted')) {\n            _context5.next = 14;\n            break;\n          }\n\n          return _context5.abrupt(\"return\", PermissionStatus.GRANTED);\n\n        case 14:\n          if (!(state === 'denied')) {\n            _context5.next = 16;\n            break;\n          }\n\n          return _context5.abrupt(\"return\", PermissionStatus.DENIED);\n\n        case 16:\n          return _context5.abrupt(\"return\", null);\n\n        case 17:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction enumerateDevices() {\n  return _regeneratorRuntime.async(function enumerateDevices$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          if (!(navigator && navigator.mediaDevices && navigator.mediaDevices.enumerateDevices)) {\n            _context6.next = 4;\n            break;\n          }\n\n          _context6.next = 3;\n          return _regeneratorRuntime.awrap(navigator.mediaDevices.enumerateDevices());\n\n        case 3:\n          return _context6.abrupt(\"return\", _context6.sent);\n\n        case 4:\n          if (!(window.MediaStreamTrack && typeof window.MediaStreamTrack.getSources === 'function')) {\n            _context6.next = 8;\n            break;\n          }\n\n          _context6.next = 7;\n          return _regeneratorRuntime.awrap(MediaStreamTrack.getSources());\n\n        case 7:\n          return _context6.abrupt(\"return\", _context6.sent);\n\n        case 8:\n          return _context6.abrupt(\"return\", null);\n\n        case 9:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction askSensorPermissionAsync() {\n  var requestPermission, status;\n  return _regeneratorRuntime.async(function askSensorPermissionAsync$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          requestPermission = getRequestMotionPermission();\n\n          if (requestPermission) {\n            _context7.next = 3;\n            break;\n          }\n\n          return _context7.abrupt(\"return\", PermissionStatus.GRANTED);\n\n        case 3:\n          _context7.next = 5;\n          return _regeneratorRuntime.awrap(requestPermission());\n\n        case 5:\n          status = _context7.sent;\n          _context7.t0 = status;\n          _context7.next = _context7.t0 === 'granted' ? 9 : _context7.t0 === 'denied' ? 10 : 11;\n          break;\n\n        case 9:\n          return _context7.abrupt(\"return\", PermissionStatus.GRANTED);\n\n        case 10:\n          return _context7.abrupt(\"return\", PermissionStatus.DENIED);\n\n        case 11:\n          return _context7.abrupt(\"return\", PermissionStatus.UNDETERMINED);\n\n        case 12:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction getMediaMaybeGrantedAsync(targetKind) {\n  var devices, result;\n  return _regeneratorRuntime.async(function getMediaMaybeGrantedAsync$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          _context8.next = 2;\n          return _regeneratorRuntime.awrap(enumerateDevices());\n\n        case 2:\n          devices = _context8.sent;\n\n          if (devices) {\n            _context8.next = 5;\n            break;\n          }\n\n          return _context8.abrupt(\"return\", false);\n\n        case 5:\n          _context8.next = 7;\n          return _regeneratorRuntime.awrap(devices.filter(function (_ref3) {\n            var kind = _ref3.kind;\n            return kind === targetKind;\n          }).some(function (_ref4) {\n            var label = _ref4.label;\n            return label !== '';\n          }));\n\n        case 7:\n          result = _context8.sent;\n          return _context8.abrupt(\"return\", result);\n\n        case 9:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nfunction getPermissionAsync(permission, shouldAsk) {\n  var status, _window, _window$Notification, Notification, _status, _status2, hasInsecureSensors, maybeStatus, _maybeStatus, maybeGranted, _maybeStatus2, _maybeGranted;\n\n  return _regeneratorRuntime.async(function getPermissionAsync$(_context9) {\n    while (1) {\n      switch (_context9.prev = _context9.next) {\n        case 0:\n          _context9.t0 = permission;\n          _context9.next = _context9.t0 === 'userFacingNotifications' ? 3 : _context9.t0 === 'notifications' ? 3 : _context9.t0 === 'motion' ? 20 : _context9.t0 === 'location' ? 31 : _context9.t0 === 'audioRecording' ? 47 : _context9.t0 === 'camera' ? 70 : 93;\n          break;\n\n        case 3:\n          if (shouldAsk) {\n            _context9.next = 9;\n            break;\n          }\n\n          _context9.next = 6;\n          return _regeneratorRuntime.awrap(getPermissionWithQueryAsync('notifications'));\n\n        case 6:\n          status = _context9.sent;\n\n          if (!status) {\n            _context9.next = 9;\n            break;\n          }\n\n          return _context9.abrupt(\"return\", {\n            status: status,\n            expires: 'never',\n            granted: status === PermissionStatus.GRANTED,\n            canAskAgain: true\n          });\n\n        case 9:\n          _window = window, _window$Notification = _window.Notification, Notification = _window$Notification === void 0 ? {} : _window$Notification;\n\n          if (!Notification.requestPermission) {\n            _context9.next = 19;\n            break;\n          }\n\n          _status = Notification.permission;\n\n          if (!shouldAsk) {\n            _context9.next = 16;\n            break;\n          }\n\n          _context9.next = 15;\n          return _regeneratorRuntime.awrap(Notification.requestPermission());\n\n        case 15:\n          _status = _context9.sent;\n\n        case 16:\n          if (!(!_status || _status === 'default')) {\n            _context9.next = 18;\n            break;\n          }\n\n          return _context9.abrupt(\"return\", {\n            status: PermissionStatus.UNDETERMINED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false\n          });\n\n        case 18:\n          return _context9.abrupt(\"return\", {\n            status: _status,\n            expires: 'never',\n            canAskAgain: true,\n            granted: _status === PermissionStatus.GRANTED\n          });\n\n        case 19:\n          return _context9.abrupt(\"break\", 94);\n\n        case 20:\n          if (!shouldAsk) {\n            _context9.next = 29;\n            break;\n          }\n\n          _context9.next = 23;\n          return _regeneratorRuntime.awrap(askSensorPermissionAsync());\n\n        case 23:\n          _status2 = _context9.sent;\n          _context9.next = 26;\n          return _regeneratorRuntime.awrap(askSensorPermissionAsync());\n\n        case 26:\n          _context9.t1 = _context9.sent;\n          _context9.t2 = _status2 === PermissionStatus.GRANTED;\n          return _context9.abrupt(\"return\", {\n            status: _context9.t1,\n            expires: 'never',\n            granted: _context9.t2,\n            canAskAgain: false\n          });\n\n        case 29:\n          hasInsecureSensors = !isIOS() && !getRequestMotionPermission();\n          return _context9.abrupt(\"return\", {\n            status: hasInsecureSensors ? PermissionStatus.GRANTED : PermissionStatus.UNDETERMINED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false\n          });\n\n        case 31:\n          _context9.next = 33;\n          return _regeneratorRuntime.awrap(getPermissionWithQueryAsync('geolocation'));\n\n        case 33:\n          maybeStatus = _context9.sent;\n\n          if (!maybeStatus) {\n            _context9.next = 42;\n            break;\n          }\n\n          if (!(maybeStatus === PermissionStatus.UNDETERMINED && shouldAsk)) {\n            _context9.next = 39;\n            break;\n          }\n\n          _context9.next = 38;\n          return _regeneratorRuntime.awrap(askForLocationPermissionAsync());\n\n        case 38:\n          return _context9.abrupt(\"return\", _context9.sent);\n\n        case 39:\n          return _context9.abrupt(\"return\", {\n            status: maybeStatus,\n            expires: 'never',\n            canAskAgain: true,\n            granted: maybeStatus === PermissionStatus.GRANTED\n          });\n\n        case 42:\n          if (!shouldAsk) {\n            _context9.next = 46;\n            break;\n          }\n\n          _context9.next = 45;\n          return _regeneratorRuntime.awrap(askForLocationPermissionAsync());\n\n        case 45:\n          return _context9.abrupt(\"return\", _context9.sent);\n\n        case 46:\n          return _context9.abrupt(\"break\", 94);\n\n        case 47:\n          _context9.next = 49;\n          return _regeneratorRuntime.awrap(getPermissionWithQueryAsync('microphone'));\n\n        case 49:\n          _maybeStatus = _context9.sent;\n\n          if (!_maybeStatus) {\n            _context9.next = 58;\n            break;\n          }\n\n          if (!(_maybeStatus === PermissionStatus.UNDETERMINED && shouldAsk)) {\n            _context9.next = 55;\n            break;\n          }\n\n          _context9.next = 54;\n          return _regeneratorRuntime.awrap(askForMicrophonePermissionAsync());\n\n        case 54:\n          return _context9.abrupt(\"return\", _context9.sent);\n\n        case 55:\n          return _context9.abrupt(\"return\", {\n            status: _maybeStatus,\n            expires: 'never',\n            canAskAgain: true,\n            granted: _maybeStatus === PermissionStatus.GRANTED\n          });\n\n        case 58:\n          if (!shouldAsk) {\n            _context9.next = 64;\n            break;\n          }\n\n          _context9.next = 61;\n          return _regeneratorRuntime.awrap(askForMicrophonePermissionAsync());\n\n        case 61:\n          return _context9.abrupt(\"return\", _context9.sent);\n\n        case 64:\n          _context9.next = 66;\n          return _regeneratorRuntime.awrap(getMediaMaybeGrantedAsync('audioinput'));\n\n        case 66:\n          maybeGranted = _context9.sent;\n\n          if (!maybeGranted) {\n            _context9.next = 69;\n            break;\n          }\n\n          return _context9.abrupt(\"return\", {\n            status: PermissionStatus.GRANTED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: true\n          });\n\n        case 69:\n          return _context9.abrupt(\"break\", 94);\n\n        case 70:\n          _context9.next = 72;\n          return _regeneratorRuntime.awrap(getPermissionWithQueryAsync('camera'));\n\n        case 72:\n          _maybeStatus2 = _context9.sent;\n\n          if (!_maybeStatus2) {\n            _context9.next = 81;\n            break;\n          }\n\n          if (!(_maybeStatus2 === PermissionStatus.UNDETERMINED && shouldAsk)) {\n            _context9.next = 78;\n            break;\n          }\n\n          _context9.next = 77;\n          return _regeneratorRuntime.awrap(askForCameraPermissionAsync());\n\n        case 77:\n          return _context9.abrupt(\"return\", _context9.sent);\n\n        case 78:\n          return _context9.abrupt(\"return\", {\n            status: _maybeStatus2,\n            expires: 'never',\n            canAskAgain: true,\n            granted: _maybeStatus2 === PermissionStatus.GRANTED\n          });\n\n        case 81:\n          if (!shouldAsk) {\n            _context9.next = 87;\n            break;\n          }\n\n          _context9.next = 84;\n          return _regeneratorRuntime.awrap(askForCameraPermissionAsync());\n\n        case 84:\n          return _context9.abrupt(\"return\", _context9.sent);\n\n        case 87:\n          _context9.next = 89;\n          return _regeneratorRuntime.awrap(getMediaMaybeGrantedAsync('videoinput'));\n\n        case 89:\n          _maybeGranted = _context9.sent;\n\n          if (!_maybeGranted) {\n            _context9.next = 92;\n            break;\n          }\n\n          return _context9.abrupt(\"return\", {\n            status: PermissionStatus.GRANTED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: true\n          });\n\n        case 92:\n          return _context9.abrupt(\"break\", 94);\n\n        case 93:\n          return _context9.abrupt(\"break\", 94);\n\n        case 94:\n          return _context9.abrupt(\"return\", {\n            status: PermissionStatus.UNDETERMINED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false\n          });\n\n        case 95:\n        case \"end\":\n          return _context9.stop();\n      }\n    }\n  }, null, null, null, Promise);\n}\n\nexport default {\n  get name() {\n    return 'ExpoPermissions';\n  },\n\n  getAsync: function getAsync(permissionTypes) {\n    var results, _iterator, _step, permissionType;\n\n    return _regeneratorRuntime.async(function getAsync$(_context10) {\n      while (1) {\n        switch (_context10.prev = _context10.next) {\n          case 0:\n            results = {};\n            _iterator = _createForOfIteratorHelperLoose(new Set(permissionTypes));\n\n          case 2:\n            if ((_step = _iterator()).done) {\n              _context10.next = 9;\n              break;\n            }\n\n            permissionType = _step.value;\n            _context10.next = 6;\n            return _regeneratorRuntime.awrap(getPermissionAsync(permissionType, false));\n\n          case 6:\n            results[permissionType] = _context10.sent;\n\n          case 7:\n            _context10.next = 2;\n            break;\n\n          case 9:\n            return _context10.abrupt(\"return\", results);\n\n          case 10:\n          case \"end\":\n            return _context10.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  },\n  askAsync: function askAsync(permissionTypes) {\n    var results, _iterator2, _step2, permissionType;\n\n    return _regeneratorRuntime.async(function askAsync$(_context11) {\n      while (1) {\n        switch (_context11.prev = _context11.next) {\n          case 0:\n            results = {};\n            _iterator2 = _createForOfIteratorHelperLoose(new Set(permissionTypes));\n\n          case 2:\n            if ((_step2 = _iterator2()).done) {\n              _context11.next = 9;\n              break;\n            }\n\n            permissionType = _step2.value;\n            _context11.next = 6;\n            return _regeneratorRuntime.awrap(getPermissionAsync(permissionType, true));\n\n          case 6:\n            results[permissionType] = _context11.sent;\n\n          case 7:\n            _context11.next = 2;\n            break;\n\n          case 9:\n            return _context11.abrupt(\"return\", results);\n\n          case 10:\n          case \"end\":\n            return _context11.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n};\nexport function getRequestMotionPermission() {\n  var _ref5, _DeviceMotionEvent$re, _DeviceMotionEvent, _DeviceOrientationEve;\n\n  return (_ref5 = (_DeviceMotionEvent$re = (_DeviceMotionEvent = DeviceMotionEvent) == null ? void 0 : _DeviceMotionEvent.requestPermission) != null ? _DeviceMotionEvent$re : (_DeviceOrientationEve = DeviceOrientationEvent) == null ? void 0 : _DeviceOrientationEve.requestPermission) != null ? _ref5 : null;\n}\n\nfunction isIOS() {\n  var isIOSUA = /(iPad|iPhone|iPod)/g.test(navigator.userAgent);\n  var isIE11 = !!window['MSStream'];\n  return isIOSUA && !isIE11;\n}","map":{"version":3,"sources":["../src/ExpoPermissions.web.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  PermissionMap,\n  PermissionType,\n  PermissionStatus,\n  PermissionInfo,\n} from './Permissions.types';\n\n/*\n * TODO: Bacon: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Permissions\n * Add messages to manifest like we do with iOS info.plist\n */\n\n// https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Using_the_new_API_in_older_browsers\n// Older browsers might not implement mediaDevices at all, so we set an empty object first\nfunction _getUserMedia(constraints: MediaStreamConstraints): Promise<MediaStream> {\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    return navigator.mediaDevices.getUserMedia(constraints);\n  }\n\n  // Some browsers partially implement mediaDevices. We can't just assign an object\n  // with getUserMedia as it would overwrite existing properties.\n  // Here, we will just add the getUserMedia property if it's missing.\n\n  // First get ahold of the legacy getUserMedia, if present\n  const getUserMedia =\n    navigator.getUserMedia ||\n    (navigator as any).webkitGetUserMedia ||\n    (navigator as any).mozGetUserMedia ||\n    function() {\n      const error: any = new Error('Permission unimplemented');\n      error.code = 0;\n      error.name = 'NotAllowedError';\n      throw error;\n    };\n\n  return new Promise((resolve, reject) => {\n    getUserMedia.call(navigator, constraints, resolve, reject);\n  });\n}\n\nasync function askForMediaPermissionAsync(\n  options: MediaStreamConstraints\n): Promise<PermissionInfo> {\n  try {\n    await _getUserMedia(options);\n    return {\n      status: PermissionStatus.GRANTED,\n      expires: 'never',\n      canAskAgain: true,\n      granted: true,\n    };\n  } catch ({ message }) {\n    // name: NotAllowedError\n    // code: 0\n    if (message === 'Permission dismissed') {\n      // message: Permission dismissed\n      return {\n        status: PermissionStatus.UNDETERMINED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: false,\n      };\n    } else {\n      // TODO: Bacon: [OSX] The system could deny access to chrome.\n      // TODO: Bacon: add: { status: 'unimplemented' }\n      // message: Permission denied\n      return {\n        status: PermissionStatus.DENIED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: false,\n      };\n    }\n  }\n}\n\nasync function askForMicrophonePermissionAsync(): Promise<PermissionInfo> {\n  return await askForMediaPermissionAsync({ audio: true });\n}\n\nasync function askForCameraPermissionAsync(): Promise<PermissionInfo> {\n  return await askForMediaPermissionAsync({ video: true });\n}\n\nasync function askForLocationPermissionAsync(): Promise<PermissionInfo> {\n  return new Promise(resolve => {\n    navigator.geolocation.getCurrentPosition(\n      () =>\n        resolve({\n          status: PermissionStatus.GRANTED,\n          expires: 'never',\n          canAskAgain: true,\n          granted: true,\n        }),\n      ({ code }: PositionError) => {\n        // https://developer.mozilla.org/en-US/docs/Web/API/PositionError/code\n        if (code === 1) {\n          resolve({\n            status: PermissionStatus.DENIED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false,\n          });\n        } else {\n          resolve({\n            status: PermissionStatus.UNDETERMINED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false,\n          });\n        }\n      }\n    );\n  });\n}\n\nasync function getPermissionWithQueryAsync(name: PermissionName): Promise<PermissionStatus | null> {\n  if (!navigator || !navigator.permissions || !navigator.permissions.query) return null;\n\n  const { state } = await navigator.permissions.query({ name });\n  if (state === 'prompt') {\n    return PermissionStatus.UNDETERMINED;\n  } else if (state === 'granted') {\n    return PermissionStatus.GRANTED;\n  } else if (state === 'denied') {\n    return PermissionStatus.DENIED;\n  }\n  return null;\n}\n\nasync function enumerateDevices(): Promise<MediaDeviceInfo[] | null> {\n  if (navigator && navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {\n    return await navigator.mediaDevices.enumerateDevices();\n  }\n\n  // @ts-ignore: This is deprecated but we should still attempt to use it.\n  if (window.MediaStreamTrack && typeof window.MediaStreamTrack.getSources === 'function') {\n    // @ts-ignore\n    return await MediaStreamTrack.getSources();\n  }\n  return null;\n}\n\nasync function askSensorPermissionAsync(): Promise<PermissionStatus> {\n  const requestPermission = getRequestMotionPermission();\n  // Technically this is incorrect because it doesn't account for iOS 12.2 Safari.\n  // But unfortunately we can only abstract so much.\n  if (!requestPermission) return PermissionStatus.GRANTED;\n\n  // If this isn't invoked in a touch-event then it never resolves.\n  // Safari probably should throw an error but because it doesn't we have no way of informing the developer.\n  const status = await requestPermission();\n  switch (status) {\n    case 'granted':\n      return PermissionStatus.GRANTED;\n    case 'denied':\n      return PermissionStatus.DENIED;\n    default:\n      return PermissionStatus.UNDETERMINED;\n  }\n}\n\nasync function getMediaMaybeGrantedAsync(targetKind: MediaDeviceKind): Promise<boolean> {\n  const devices = await enumerateDevices();\n  if (!devices) {\n    return false;\n  }\n  const result = await devices\n    .filter(({ kind }) => kind === targetKind)\n    .some(({ label }) => label !== '');\n  // Granted or denied or undetermined or no devices\n  return result;\n}\n\nasync function getPermissionAsync(\n  permission: PermissionType,\n  shouldAsk: boolean\n): Promise<PermissionInfo> {\n  switch (permission) {\n    case 'userFacingNotifications':\n    case 'notifications':\n      {\n        if (!shouldAsk) {\n          const status = await getPermissionWithQueryAsync('notifications');\n          if (status) {\n            return {\n              status,\n              expires: 'never',\n              granted: status === PermissionStatus.GRANTED,\n              canAskAgain: true,\n            };\n          }\n        }\n\n        const { Notification = {} } = window as any;\n        if (Notification.requestPermission) {\n          let status = Notification.permission;\n          if (shouldAsk) {\n            status = await Notification.requestPermission();\n          }\n          if (!status || status === 'default') {\n            return {\n              status: PermissionStatus.UNDETERMINED,\n              expires: 'never',\n              canAskAgain: true,\n              granted: false,\n            };\n          }\n          return {\n            status,\n            expires: 'never',\n            canAskAgain: true,\n            granted: status === PermissionStatus.GRANTED,\n          };\n        }\n      }\n      break;\n    case 'motion': {\n      if (shouldAsk) {\n        const status = await askSensorPermissionAsync();\n        return {\n          status: await askSensorPermissionAsync(),\n          expires: 'never',\n          granted: status === PermissionStatus.GRANTED,\n          canAskAgain: false,\n        };\n      }\n      // We can infer from the requestor if this is an older browser.\n      const hasInsecureSensors = !isIOS() && !getRequestMotionPermission();\n      return {\n        status: hasInsecureSensors ? PermissionStatus.GRANTED : PermissionStatus.UNDETERMINED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: false,\n      };\n    }\n    case 'location':\n      {\n        const maybeStatus = await getPermissionWithQueryAsync('geolocation');\n        if (maybeStatus) {\n          if (maybeStatus === PermissionStatus.UNDETERMINED && shouldAsk) {\n            return await askForLocationPermissionAsync();\n          }\n          return {\n            status: maybeStatus,\n            expires: 'never',\n            canAskAgain: true,\n            granted: maybeStatus === PermissionStatus.GRANTED,\n          };\n        } else if (shouldAsk) {\n          // TODO: Bacon: should this function as ask async when not in chrome?\n          return await askForLocationPermissionAsync();\n        }\n      }\n      break;\n    case 'audioRecording':\n      {\n        const maybeStatus = await getPermissionWithQueryAsync('microphone');\n        if (maybeStatus) {\n          if (maybeStatus === PermissionStatus.UNDETERMINED && shouldAsk) {\n            return await askForMicrophonePermissionAsync();\n          }\n          return {\n            status: maybeStatus,\n            expires: 'never',\n            canAskAgain: true,\n            granted: maybeStatus === PermissionStatus.GRANTED,\n          };\n        } else if (shouldAsk) {\n          return await askForMicrophonePermissionAsync();\n        } else {\n          const maybeGranted = await getMediaMaybeGrantedAsync('audioinput');\n          if (maybeGranted) {\n            return {\n              status: PermissionStatus.GRANTED,\n              expires: 'never',\n              canAskAgain: true,\n              granted: true,\n            };\n          }\n          // TODO: Bacon: Get denied or undetermined...\n        }\n      }\n      break;\n    case 'camera':\n      {\n        const maybeStatus = await getPermissionWithQueryAsync('camera');\n        if (maybeStatus) {\n          if (maybeStatus === PermissionStatus.UNDETERMINED && shouldAsk) {\n            return await askForCameraPermissionAsync();\n          }\n          return {\n            status: maybeStatus,\n            expires: 'never',\n            canAskAgain: true,\n            granted: maybeStatus === PermissionStatus.GRANTED,\n          };\n        } else if (shouldAsk) {\n          return await askForCameraPermissionAsync();\n        } else {\n          const maybeGranted = await getMediaMaybeGrantedAsync('videoinput');\n          if (maybeGranted) {\n            return {\n              status: PermissionStatus.GRANTED,\n              expires: 'never',\n              canAskAgain: true,\n              granted: true,\n            };\n          }\n          // TODO: Bacon: Get denied or undetermined...\n        }\n      }\n      break;\n    default:\n      break;\n  }\n  return {\n    status: PermissionStatus.UNDETERMINED,\n    expires: 'never',\n    canAskAgain: true,\n    granted: false,\n  };\n}\n\nexport default {\n  get name(): string {\n    return 'ExpoPermissions';\n  },\n\n  async getAsync(permissionTypes: PermissionType[]): Promise<PermissionMap> {\n    const results = {};\n    for (const permissionType of new Set(permissionTypes)) {\n      results[permissionType] = await getPermissionAsync(permissionType, /* shouldAsk */ false);\n    }\n    return results;\n  },\n\n  async askAsync(permissionTypes: PermissionType[]): Promise<PermissionMap> {\n    const results = {};\n    for (const permissionType of new Set(permissionTypes)) {\n      results[permissionType] = await getPermissionAsync(permissionType, /* shouldAsk */ true);\n    }\n    return results;\n  },\n};\n\nexport function getRequestMotionPermission(): () => Promise<PermissionState> | null {\n  // @ts-ignore: requestPermission does not exist\n  return DeviceMotionEvent?.requestPermission ?? DeviceOrientationEvent?.requestPermission ?? null;\n}\n\n// https://stackoverflow.com/a/9039885/4047926\nfunction isIOS(): boolean {\n  const isIOSUA = /(iPad|iPhone|iPod)/g.test(navigator.userAgent);\n  const isIE11 = !!window['MSStream'];\n  return isIOSUA && !isIE11;\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}